# DP 200 - データ プラットフォーム ソリューションの実装
# ラボ 8 - Azure データ プラットフォームのセキュリティ保護

**推定時間**: 75 分

**前提条件**: このラボのケース スタディは既に確認していることを前提としています。モジュール 1 からモジュール 7 の内容とラボを完了していることを前提としています。

**ラボ ファイル**: このラボのファイルは、_Allfiles\Labfiles\Starter\DP-200.8_ フォルダーにあります。

## ラボの概要

受講者は、多層防御を実現するために選択できる、さまざまなセキュリティのアプローチを理解して文書化します。これには、本コースでこれまでに設定したセキュリティの文書化も含まれます。AdventureWorks に存在する可能性のあるセキュリティのギャップを特定する方法についても確認します。

## ラボの目的
  
このラボを完了すると、次のことができるようになります。

1. セキュリティについて説明する
2. 主要なセキュリティ コンポーネントについて説明する
3. Storage Accounts と Data Lake Storage をセキュリティで保護する
4. データ ストアをセキュリティで保護する
5. ストリーミング データをセキュリティで保護する

## シナリオ
  
あなたは、AdventureWorks のシニア データ エンジニアとして、会社のデータ資産が確実に保護されていることを確認する責任があります。必要な場所にセキュリティ対策を確実に施していることを確認するために、現在のインフラストラクチャのセキュリティ検査を行います。この検査は、これまでに作成したすべてのサービスとデータを全体的に点検することと、存在するかもしれない不適切なセキュリティ設定を明らかにすることを目的としています。 

あなたは、SQL データベースのセキュリティを強化するように求められており、データベースに対する監査を設定してデータベースへのアクセスをモニターできるようにすることも求められています。いっぽう、イベント ハブの管理アクセス許可に対する制限が十分でないことに気づきました。このアクセス許可を削除する必要があると考えています。

このラボでは、次のことを行います。

1. セキュリティについて理解する
2. 主要なセキュリティ コンポーネントを確認する
3. ストレージ アカウントと Data Lake Storage をセキュリティで保護する
4. データ ストアをセキュリティで保護する
5. ストリーミング データをセキュリティで保護する

> **重要**: このラボを進める中で発生したプロビジョニングまたは構成タスクの問題については、メモに書き留め、_\Labfiles\DP-200-Issues-Docx_にあるドキュメントの表に記録してください。ラボ番号、テクノロジ、発生した問題、解決した方法を記述しておきます。このドキュメントは、後のモジュールで参照できるように保存します。

## 演習 1: セキュリティの概要

推定時間: 15 分

グループ演習
  
この演習の主なタスクは、以下の通りです。

1. 多層の対策でセキュリティを確保します。

2. インストラクターは、わかったことについてグループと話し合います。

### タスク 1: 多層の対策でセキュリティを確保します。

1. ラボの仮想マシンから **Microsoft Word** を起動し、**Allfiles\Labfiles\Starter\DP-200.8** フォルダーからファイル **DP-200-Lab08-Ex01.docx** を開きます。

2. コースの内容、ケース スタディ、これまでコースで取り上げたシナリオから、ラボで AdventureWorks のセキュリティを確保するために、これまでに施した複数のセキュリティ層を特定します。グループで **10 分間**かけてください。例を 3 つ見つけてください。

### タスク 2: わかったことについてインストラクターと話し合う

1. インストラクターは、わかったことについて話し合うためにグループを中断させます。

> **結果**: この演習を完了すると、Adventureworks でセキュリティを実装した方法と影響を受けたセキュリティ層の少なくとも 3 つの例を含む Microsoft Word ドキュメントが作成されます。

## 演習 2: 主なセキュリティ コンポーネント
  
推定時間: 10 分

個別演習
  
この演習の主なタスクは次のとおりです。

1. データとストレージのセキュリティ対策を評価します。

### タスク 1: データとストレージのセキュリティ対策を評価する

1. Azure portal タブで、「**Security Center**」 をクリックします。

    ![Azure portal の Security Center](Linked_Image_Files/M08-E01-T01-img01.png)

2. Security Center の 「概要」 画面で 「**推奨事項**」 をクリックします。

    ![Security Center - Azure portal のデータ ストレージ](Linked_Image_Files/M08-E01-T01-img02.png)

3. 注意を要する上位 2 つの主要データおよびストレージ コンポーネントを確認します。

    1. __回答は異なる場合があります_____
    1. __回答は異なる場合があります_____

> **結果**: この演習を完了すると、Azure サブスクリプション内のデータとストレージのセキュリティの弱点を特定する場所を学習することができます。

## 演習 3: ストレージ アカウントと Data Lake Storage をセキュリティで保護する
  
推定時間: 15 分

個別演習
  
この演習の主なタスクは次のとおりです。

1. Azure BLOB に対する適切なセキュリティ アプローチを決定します。

2. わかったことについてインストラクターと話し合う

### タスク 1: Azure BLOB に対する適切なセキュリティ アプローチを決定する

1. あなたは社内の Web 開発者から連絡を受け、サード パーティーの Web デザイン会社が awsastudxx ストレージ アカウントにある Web イメージへアクセスできるようにするのを支援してほしいと頼まれました。AdventureWorks のシニア データ エンジニアとして、正しいデューデリジェンスを適用しながらこれを確実に実現するには、どのような手順が必要となるでしょうか。

2. ラボの仮想マシンから **Microsoft Word** を起動し、**Allfiles\Labfiles\Starter\DP-200.8** フォルダーからファイル **DP-200-Lab08-Ex03.docx** を開きます。

### タスク 2: わかったことについてインストラクターと話し合う

1. インストラクターは、わかったことについて話し合うためにグループを中断させます。

> **結果**: この演習を完了すると、サードパーティーの Web 開発会社に BLOB ストレージ アカウントへの安全なアクセスを提供するための手順を含む Microsoft Word ドキュメントが作成されます。

## 演習 4: データ ストアをセキュリティで保護する
  
推定時間: 15 分

個別演習
  
この演習の主なタスクは次のとおりです。

1. 監査を有効化します。

2. データベースをクエリします。

3. 監査ログを表示します。

### タスク 1: 監査を有効化する

1. Azure portal で、**リソース グループ** をクリックしてから、「awrgstudxx」、「sqlservicexx」 の順にクリックして 「**AdventureworksLT (sqlservicekdwj/AdventureworksLT)**」 に移動します。

2. 「AdventureworksLT (sqlservicekdwj/AdventureworksLT)」 画面で、「**監査**」 ブレードをクリックします。

3. 「**Azure SQL 監査を有効にする**」 を「**オン**」 にします。

4. 「**ストレージ**」 ボックスをクリックしてから、「**詳細プロパティ**」 をクリックします。

5. 「**サブスクリプション - ストレージ サブスクリプションの変更**」 をクリックし、サブスクリプションをクリックします。

6. 「**ストレージ アカウントの選択**」 ドロップダウンで、「**awsastudxx**」 をクリックします。

7. 「**保有期間**」 テキスト ボックスに「**90**」と入力し、**OK**をクリックします。

    ![Azure Portal でエンドポイントを構成する](Linked_Image_Files/M08-E04-T01-img01.png)

8. 「**保存**」 をクリックします。

### タスク 2: データベースをクエリする

1. Azure portal で、**リソース グループ** をクリックしてから、「awrgstudxx」、「sqlservicexx」 の順にクリックして 「**AdventureworksLT (sqlservicekdwj/AdventureworksLT)**」 に移動します。

2. 「**クエリ エディター**」 に移動します。

3. 表示される 「**SQL サーバー認証**」 画面で、以下の詳細を入力してログインします。
    - ユーザー名: **xxsqladmin**
    - パスワード: **P@ssw0r**

4. **「OK」** をクリックします 

> **注**: パスワードが正しくないため、エラー メッセージが返されます。

5. 正しいパスワード、**Pa55w.rd** を入力します。

6. **クエリ エディタ** で、「**AdventureWorksLT**」 を展開してから、「**テーブル**」 を展開します。

7. 「SalesLT」.「Customer」 を右クリックし、「**上位 1000 行の選択**」 をクリックします。

### タスク 2: 監査ログを表示する

1. Azure portal に戻ります。「AdventureWorksLT (sqlservicexx/AdventureWorksLT) - 監査」 画面で、「**監査ログの表示**」 をクリックします。

2. 「**監査レコード**」 ログ ファイルの**失敗した認証 (DATABASE AUTHENTICATION FAILED)**レコードを確認します。「**監査レコード**」 画面を閉じます。

    ![Azure portal での監査レコードの表示](Linked_Image_Files/M08-E04-T01-img02.png)

> **結果**: この演習を完了すると、データベース監査を有効にし、監査が機能することを確認することができます。

## 演習 5: ストリーミング データをセキュリティで保護する
  
推定時間: 15 分

個別演習
  
この演習の主なタスクは次のとおりです。

1. イベント ハブのアクセス許可を変更します。

### タスク 1: イベント ハブのアクセス許可を変更する

1. Azure portal 内のブレードで、「**リソース グループ**」、「**awrgstudxx**」、「**xx-phoneanalysis-ehn**」 をクリックします。**xx** は自分のイニシャルです。

2. Azure portal の **xx-phoneanalysis-ehn** では、**xx** が自分のイニシャルとなります。ウィンドウの一番下までスクロールし、**xx-phoneanalysis-eh**イベント ハブをクリックします。

3. イベント ハブへのアクセスを許可するには、「**共有アクセス ポリシー**」 をクリックします。

4. 「**phoneanalysis-eh-sap \| 共有アクセス ポリシー**」 画面で、「**xx-phoneanalysis-eh-sap**」 をクリックします。

5. **管理**アクセス許可を横にあるチェックボックスをオンにして削除し、「**保存**」 をクリックします。

6. Azure portalのブレードで、「**ホーム**」 をクリックします。

> **結果**: この演習を完了すると、イベント ハブ共有アクセス ポリシーのセキュリティが変更されます。
